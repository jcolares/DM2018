load("/home/jeff/github/DM2018/datasets/vra.RData")
View(vra)
library(DataExplorer)
source('~/.active-rstudio-document')
load("datasets/vrawu17.RData")
View(vrawu17)
final_names = colnames(vrawu17)
final_names
load("dados/vra-wu.RData")
initial_names = colnames(vra_wu)
initial_names
head(vra_wu)
year(vra_wu$depart_expect[1])
library(lubridate)
year(vra_wu$depart_expect[1])
vra_wu_17 = vra_wu %>% filter(year(depart_expect) == 2017 | year(arrival_expect)==2017)
vra_wu_17 = vra_wu %>% filter(year(as.POSIXct(depart_expect)) == 2017 | year(as.POSIXct(arrival_expect))==2017)
vra_wu$depart_expect = as.POSIXct(vra_wu$depart_expect)
vra_wu$depart = as.POSIXct(vra_wu$depart)
vra_wu$arrival_expect = as.POSIXct(vra_wu$arrival_expect)
vra_wu$arrival = as.POSIXct(vra_wu$arrival)
vra_wu_17 = vra_wu %>% filter(year(depart_expect) == 2017 | year(arrival_expect)==2017)
rm(vra_wu)
colnames(vra_wu_17)[colnames(vra_wu_17)=="destiny"] = "icao_destino"
colnames(vra_wu_17)[colnames(vra_wu_17)=="origin"] = "icao_origem"
View(vra_wu_17)
# Alterar os nomes das colunas já existentes
colnames(vra_wu_17)[colnames(vra_wu_17)=="destiny"] = "icao_destino"
colnames(vra_wu_17)[colnames(vra_wu_17)=="origin"] = "icao_origem"
colnames(vra_wu_17)[colnames(vra_wu_17)=="airline"] = "icao_empresa"
colnames(vra_wu_17)[colnames(vra_wu_17)=="flight"] = "voo"
#colnames(vra_wu_17)[colnames(vra_wu_17)=="autho_code"] = "new_name"     #n
colnames(vra_wu_17)[colnames(vra_wu_17)=="line_type"] = "codigo_tipo_linha"
colnames(vra_wu_17)[colnames(vra_wu_17)=="depart_expect"] = "partida_prevista"
colnames(vra_wu_17)[colnames(vra_wu_17)=="depart"] = "partida_real"
colnames(vra_wu_17)[colnames(vra_wu_17)=="arrival_expect"] = "chegada_prevista"
colnames(vra_wu_17)[colnames(vra_wu_17)=="arrival"] = "chegada_real"
colnames(vra_wu_17)[colnames(vra_wu_17)=="status"] = "situacao_voo"
colnames(vra_wu_17)[colnames(vra_wu_17)=="observation"] = "cod_justificativa"
colnames(vra_wu_17)[colnames(vra_wu_17)=="departure_delay"] = "atraso_partida"
colnames(vra_wu_17)[colnames(vra_wu_17)=="arrival_delay"] = "atraso_chegada"
#colnames(vra_wu_17)[colnames(vra_wu_17)=="duration_expect"] = "duracao_prevista"   #não existia no nosso vrawu17
#colnames(vra_wu_17)[colnames(vra_wu_17)=="duration"] = "duracao_real"    #não existia no nosso vrawu17
#colnames(vra_wu_17)[colnames(vra_wu_17)=="duration_delta"] = "duracao_delta"   #não existia no nosso vrawu17
colnames(vra_wu_17)[colnames(vra_wu_17)=="origin.state"] = "origem_uf"
colnames(vra_wu_17)[colnames(vra_wu_17)=="destiny.state"] = "destino_uf"
colnames(vra_wu_17)[colnames(vra_wu_17)=="depart_temperature"] = "origem_temperatura"
colnames(vra_wu_17)[colnames(vra_wu_17)=="depart_dew_point"] = "origem_dew_point"
colnames(vra_wu_17)[colnames(vra_wu_17)=="depart_humidity"] = "origem_umidade"
colnames(vra_wu_17)[colnames(vra_wu_17)=="depart_pressure"] = "origem_pressao"
colnames(vra_wu_17)[colnames(vra_wu_17)=="depart_visibility"] = "origem_visibilidade"
colnames(vra_wu_17)[colnames(vra_wu_17)=="depart_events"] = "origem_eventos"
colnames(vra_wu_17)[colnames(vra_wu_17)=="depart_conditions"] = "origem_condicoes"
colnames(vra_wu_17)[colnames(vra_wu_17)=="arrival_temperature"] = "destino_temperatura"
colnames(vra_wu_17)[colnames(vra_wu_17)=="arrival_dew_point"] = "destino_dew_point"
colnames(vra_wu_17)[colnames(vra_wu_17)=="arrival_humidity"] = "destino_umidade"
colnames(vra_wu_17)[colnames(vra_wu_17)=="arrival_pressure"] = "destino_pressao"
colnames(vra_wu_17)[colnames(vra_wu_17)=="arrival_visibility"] = "destino_visibilidade"
colnames(vra_wu_17)[colnames(vra_wu_17)=="arrival_events"] = "destino_eventos"
colnames(vra_wu_17)[colnames(vra_wu_17)=="arrival_conditions"] = "destino_condicoes"
View(vra_wu_17)
# Carregar dimensões - aerodromos
aerodromos <- read_excel("dados/glossario_de_aerodromo.xls", skip = 3, col_names = TRUE )
library(readxl)
# Carregar dimensões - aerodromos
aerodromos <- read_excel("dados/glossario_de_aerodromo.xls", skip = 3, col_names = TRUE )
origens <- aerodromos
colnames(origens) <- c("icao_origem", "origem_descricao", "origem_cidade","origem_uf", "origem_pais", "origem_continente")
vrawu17 <- merge(x=vrawu17, y=origens, all.x = TRUE)
View(aerodromos)
vra_wu_17 <- merge(x=vra_wu_17, y=origens, all.x = TRUE, by.x=icao_origem, by.y=icao_origem)
vra_wu_17 <- merge(x=vra_wu_17, y=origens, all.x = TRUE, by.x=icao_origem, by.y=icao_origem)
vra_wu_17$icao_origem = as.character(vra_wu_17$icao_origem)
vra_wu_17 <- merge(x=vra_wu_17, y=origens, all.x = TRUE, by.x=icao_origem, by.y=icao_origem)
vra_wu_17 <- merge(x=vra_wu_17, y=origens, all.x = TRUE, by.x='icao_origem', by.y='icao_origem')
colnames(vra_wu_17)[colnames(vra_wu_17)=="origem_uf.y"] = "origem_uf"
vra_wu_17$origem_uf.x = NULL
destinos <- aerodromos
colnames(destinos) <- c("icao_destino", "destino_descricao", "destino_cidade","destino_uf", "destino_pais", "destino_continente")
vra_wu_17 <- merge(x=vra_wu_17, y=destinos, all.x = TRUE, by.x='icao_destino', by.y='icao_destino')
colnames(vra_wu_17)[colnames(vra_wu_17)=="destino_uf.y"] = "destino_uf"
vra_wu_17$destino_uf.x = NULL
rm(origens, destinos, aerodromos)
count(vra_wu_17$autho_code)
#Carrega dimensoes - DI
vra_wu_17$cod_di = as.character(vra_wu_17$autho_code)
count(vra_wu_17$cod_di)
count(vra_wu_17$cod_di)
unique(vra_wu_17$cod_di)
#Carrega dimensoes - DI
vra_wu_17$cod_di = NULL
vra_wu_17$autho_code
#Carrega dimensoes - DI
vra_wu_17$codigo_di = as.character(vra_wu_17$autho_code)
unique(vra_wu_17$codigo_di)
di <- read_excel("~/github/DM2018/dados/glossario_de_digito_identificador.xls", skip = 3, col_names = TRUE )
di <- read_excel("dados/glossario_de_digito_identificador.xls", skip = 3, col_names = TRUE )
colnames(di) <- c("codigo_di", "descricao_codigo_di")
View(di)
vrawu17 <- merge(x=vrawu17, y=di, all.x = TRUE)
vra_wu_17 <- merge(x=vra_wu_17, y=di, all.x = TRUE)
rm(di)
vra_wu_17$autho_code = NULL
# Carrega dimensões - empresa
empresas <- read_excel("dados/glossario_de_empresas_aereas.xls", skip = 3, col_names = TRUE )
colnames(empresas) <- c("icao_empresa", "empresa", "x1", "nacionalidade")
empresas$x1 <- NULL
vra_wu_17 <- merge(x=vra_wu_17, y=empresas, all.x = TRUE)
rm(empresas)
# Carrega dimensões - justificativas
#Obs: o arquivo original de justificativas continha caracteres estranhos que impediam sua leitura
#     foi necessário editar o xls antes de carregar
justificativas <- read_excel("~/github/DM2018/dados/glossario_de_justificativas.xls", skip = 3, col_names = TRUE )
colnames(justificativas) <- c("cod_justificativa", "descricao_justificativa")
vrawu17 <- merge(x=vrawu17, y=justificativas, all.x = TRUE)
vra_wu_17 <- merge(x=vra_wu_17, y=justificativas, all.x = TRUE)
rm(justificativas)
# Carrega dimensões - tipo de linha
tipo_linha <- read_excel("dados/glossario_de_tipo_de_linha.xls", skip = 3, col_names = TRUE )
View(tipo_linha)
colnames(tipo_linha) <- c("codigo_tipo_linha", "tipo_linha")
vra_wu_17 <- merge(x=vra_wu_17, y=tipo_linha, all.x = TRUE)
rm(tipo_linha)
View(vra_wu_17)
View(vra_wu_17)
#Adiciona colunas de id de tempo
timekey_partida <- paste(substr(vra_wu_17$partida_prevista,1,4), substr(vra_wu_17$partida_prevista,6,7), substr(vra_wu_17$partida_prevista,9,10), substr(vra_wu_17$partida_prevista,12,13), "00", sep = "")
View(timekey_partida)
vra17 <- cbind(vra_wu_17,timekey_partida)
rm(vra17)
vra_wu_17$timekey_chegada <- paste(substr(vra_wu_17$chegada_prevista,1,4), substr(vra_wu_17$chegada_prevista,6,7), substr(vra_wu_17$chegada_prevista,9,10), substr(vra_wu_17$chegada_prevista,12,13), "00", sep = "")
View(vra_wu_17)
#Adiciona colunas de id de tempo
vra_wu_17$timekey_partida <- paste(substr(vra_wu_17$partida_prevista,1,4), substr(vra_wu_17$partida_prevista,6,7), substr(vra_wu_17$partida_prevista,9,10), substr(vra_wu_17$partida_prevista,12,13), "00", sep = "")
as.Date(vra_wu_17$partida_prevista[1])
# datas
vra_wu_17$origem_data = as.Date(vra_wu_17$partida_prevista)
# Carregar dimensões - aerodromos
aerodromos <- read_excel("dados/glossario_de_aerodromo.xls", skip = 3, col_names = TRUE )
# datas
vra_wu_17$origem_data = as.hour(vra_wu_17$partida_prevista)
substr(vra_wu_17$partida_prevista[1], 1,10)
substr(vra_wu_17$partida_prevista[1], 1,14)
substr(vra_wu_17$partida_prevista[1], 1,13)
substr(vra_wu_17$partida_prevista[1], 11,2)
substr(vra_wu_17$partida_prevista[1], 12,2)
substr(vra_wu_17$partida_prevista[1], 12,4)
substr(vra_wu_17$partida_prevista[1], 10,4)
substr(vra_wu_17$partida_prevista[1], 1,4)
substr(vra_wu_17$partida_prevista[1], 2,4)
substr(vra_wu_17$partida_prevista[1], 11,13)
substr(vra_wu_17$partida_prevista[1], 12,13)
as numeric(substr(vra_wu_17$partida_prevista[1], 12,13))
as.numeric(substr(vra_wu_17$partida_prevista[1], 12,13))
vra_wu_17$origem_hora = as.numeric(substr(vra_wu_17$partida_prevista, 12,13))
vra_wu_17$destno_data = as.Date(vra_wu_17$chegada_prevista)
vra_wu_17$destino_hora = as.numeric(substr(vra_wu_17$chegada_prevista, 12,13))
