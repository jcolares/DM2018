#bibliotecas
library(readr)
library(dplyr)
library(DataExplorer)
library(stats)
library(ggplot2)
library(readxl)
# Carga dos dados
setwd("github/DM2018/")
load("datasets/vrawu17.RData")
source('~/github/DM2018/temp.R')
source('~/github/DM2018/temp.R')
View(justificativas)
View(justmeteorologicas)
justMeteorOrigem = filter(justificativas, cod_justificativa %in% c("WO", "XO"))
# Cria coluna target_ori, que identifica os atrasos ou cancelamentos provocados por eventos meteorológicos no aeroporto de origem
target_ori = ifelse(vrawu17$cod_justificativa %in% justMeteorOrigem$cod_justificativa, 1, 0)
vrawu17 = cbind(vrawu17, target_ori)
justMeteorOrigem = filter(justificativas, cod_justificativa %in% c("WO", "XO","WI","WS"))
# Cria coluna target_ori, que identifica os atrasos ou cancelamentos provocados por eventos meteorológicos no aeroporto de origem
target_ori = ifelse(vrawu17$cod_justificativa %in% justMeteorOrigem$cod_justificativa, 1, 0)
vrawu17 = cbind(vrawu17, target_ori)
vrawu17$target_ori <- NULL
vrawu17$target_ori <- NULL
# Cria coluna target_ori, que identifica os atrasos ou cancelamentos provocados por eventos meteorológicos no aeroporto de origem
target_ori = ifelse(vrawu17$cod_justificativa %in% justMeteorOrigem$cod_justificativa, 1, 0)
vrawu17 = cbind(vrawu17, target_ori)
rm(target, target_ori)
teste = vrawu17 %>% group_by(icao_origem)
View(teste)
teste = vrawu17 %>% group_by(icao_origem) %>% mutate(perc_atr_met = target_ori/count(target_ori))
teste = vrawu17 %>% group_by(icao_origem) %>% mutate(count = count(target_ori)) %>% group_by(icao_origem, target_ori) %>% mutate(perc_atr_met = target_ori/count(target_ori))
teste = vrawu17 %>% group_by(icao_origem) %>% mutate(count = count(target_ori)) %>% group_by(icao_origem, target_ori) %>% mutate(perc_atr_met = target_ori/count)
teste = vrawu17 %>% group_by(icao_origem) %>% mutate(perc_atr_met = sum(target_ori)/count(target_ori))
teste = vrawu17 %>% group_by(icao_origem) %>% mutate(xxx = count(target_ori))
vrawu17 %>% group_by(icao_origem) %>% mutate(xxx = count(target_ori))
vrawu17 %>% group_by(icao_origem) %>% count(target_ori)
vrawu17 %>% group_by(icao_origem) %>% count(target_ori) %>% spread(target_ori, n)
package(tidyr)
library(tidyr)
vrawu17 %>% group_by(icao_origem) %>% count(target_ori) %>% spread(target_ori, n)
vrawu17 %>% group_by(icao_origem) %>% count(target_ori) %>% spread(target_ori, n) %>% mutate(perc, 1/0)
vrawu17 %>% group_by(icao_origem) %>% count(target_ori) %>% spread(target_ori, n) %>% mutate(perc, `1`/`0`)
vrawu17 %>% group_by(icao_origem) %>% count(target_ori) %>% spread(target_ori, n) %>% mutate(perc = `1`/`0`)
vrawu17 %>% group_by(icao_origem) %>% count(target_ori) %>% spread(target_ori, n) %>% mutate(perc = `1`/`0`) %>% arrange(desc(perc))
ranking_aerop_atrasos  = vrawu17 %>% group_by(icao_origem) %>% count(target_ori) %>% spread(target_ori, n) %>% mutate(perc = `1`/`0`) %>% arrange(desc(perc))
ranking_aerop_atrasos = merge(x=ranking_aerop_atrasos, y = aerop, all.x = TRUE)
ranking_aerop_atrasos  =
vrawu17 %>%
group_by(icao_origem) %>%
count(target_ori) %>%
spread(target_ori, n) %>%
mutate(perc = `1`/`0`) %>%
arrange(desc(perc))
ranking_aerop_atrasos = merge(x=ranking_aerop_atrasos, y = aerop, by.x = icao_origem, by.y = `Código`, all.x = TRUE)
ranking_aerop_atrasos = merge(x=ranking_aerop_atrasos, y = aerop, by.x = "icao_origem", by.y = "Código", all.x = TRUE)
View(ranking_aerop_atrasos)
ggplot(ranking_aerop_atrasos, aes(x=reorder(Aeroporto,perc,sum ) , y=perc)) + geom_bar(show.legend = TRUE, stat = "identity") + coord_flip()
ranking_aerop_atrasos[:10,]
ranking_aerop_atrasos[1:10,]
ranking_aerop_atrasos %>% select(icao_origem, Aeroporto, 0, 1, Voos, perc) %>% arrange(desc(perc))
ranking_aerop_atrasos %>% select(icao_origem, Aeroporto, `0`, `1`, Voos, perc) %>% arrange(desc(perc))
ranking_aerop_atrasos = ranking_aerop_atrasos %>% select(icao_origem, Aeroporto, 0, 1, Voos, perc) %>% arrange(desc(perc))
ranking_aerop_atrasos =ranking_aerop_atrasos %>% select(icao_origem, Aeroporto, `0`, `1`, Voos, perc) %>% arrange(desc(perc))
ranking_aerop_atrasos[1:10,]
summary(ranking_aerop_atrasos)
g = ggplot(ranking_aerop_atrasos, aes(x=reorder(Aeroporto,perc,sum ) , y=perc)) + geom_bar(show.legend = TRUE, stat = "identity") + coord_flip()
g = g  +ggtitle("Area Vs Population")
plot(g)
# Exibe o gráfico
g = ggplot(ranking_aerop_atrasos, aes(x=reorder(Aeroporto,perc,sum ) , y=perc)) + geom_bar(show.legend = TRUE, stat = "identity") + coord_flip()
g = g  +ggtitle("Percentual de cancelamentos/atrasos")
plot(g)
vrawu50 =
vrawu17 %>%
filter(icao_origem %in% ranking_aerop_atrasos[1:10,1]) %>%
select(icao_origem, origem_temperatura, origem_dew_point, origem_umidade, origem_pressao, origem_visibilidade)
DataExplorer::create_report(vrawu50)
rm(teste, vrawu17)
DataExplorer::create_report(vrawu50)
